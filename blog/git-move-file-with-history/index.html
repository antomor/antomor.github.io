<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>Git: Move Files Retaining History - Antomor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="generator" content="Hugo 0.66.0" /><meta itemprop="name" content="Git: Move Files Retaining History">
<meta itemprop="description" content="How to move files among git repository retaining the history">
<meta itemprop="datePublished" content="2020-03-14T12:28:03&#43;01:00" />
<meta itemprop="dateModified" content="2020-03-14T12:28:03&#43;01:00" />
<meta itemprop="wordCount" content="560">
<meta itemprop="image" content="https://antomor.com/images/git-move.jpg">



<meta itemprop="keywords" content="dev,git,blog,tutorial," /><meta property="og:title" content="Git: Move Files Retaining History" />
<meta property="og:description" content="How to move files among git repository retaining the history" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://antomor.com/blog/git-move-file-with-history/" />
<meta property="og:image" content="https://antomor.com/images/git-move.jpg" />
<meta property="article:published_time" content="2020-03-14T12:28:03+01:00" />
<meta property="article:modified_time" content="2020-03-14T12:28:03+01:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://antomor.com/images/git-move.jpg"/>

<meta name="twitter:title" content="Git: Move Files Retaining History"/>
<meta name="twitter:description" content="How to move files among git repository retaining the history"/>
<meta name="twitter:site" content="@AntonioMorrone7"/>
<link rel="stylesheet" href="/css/bundle.min.890f30b8b199a3d390afae9cf9f69d7a932a6a7d91fc3a3b9e5b9d780c334432.css" integrity="sha256-iQ8wuLGZo9OQr66c&#43;fadepMqan2R/Do7nludeAwzRDI=">
        <link rel="stylesheet" href="/css/add-on.css">
</head>

  <body>
    
<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/">
        
          
            Blog
          
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu">
      
        
          
          
            <a href="/" class="link"><i class='fa fa-home'></i> Home</a>
          
        
      
        
          
          
            <a href="/about/" class="link"><i class='far fa-id-card'></i> About</a>
          
        
      
        
          
          
            <a href="/blog/" class="link"><i class='far fa-newspaper'></i> Blog</a>
          
        
      
        
          
          
            <a href="/categories/" class="link"><i class='fas fa-sitemap'></i> Categories</a>
          
        
      
        
          
          
            <a href="/contact/" class="link"><i class='far fa-envelope'></i> Contact</a>
          
        
      
      <a href="#share-menu" class="share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
      

    </menu>
    

    <a href="#share-menu" class="share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
    
    <a href="#site-nav" class="nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  
  
    <menu id="share-menu" class="flyout-menu">
      <h1>Share Post</h1>
      




  
    
    <a href="//twitter.com/share?text=Git%3a%20Move%20Files%20Retaining%20History&amp;url=https%3a%2f%2fantomor.com%2fblog%2fgit-move-file-with-history%2f" target="_blank" rel="noopener" class="share-btn twitter">
        <i class="fab fa-twitter"></i><p>&nbsp;Twitter</p>
      </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fantomor.com%2fblog%2fgit-move-file-with-history%2f&amp;title=Git%3a%20Move%20Files%20Retaining%20History" target="_blank" rel="noopener" class="share-btn linkedin">
            <i class="fab fa-linkedin"></i><p>&nbsp;LinkedIn</p>
          </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by antomor&amp;body=https%3a%2f%2fantomor.com%2fblog%2fgit-move-file-with-history%2f" target="_blank" class="share-btn email" data-proofer-ignore>
          <i class="fas fa-envelope"></i><p>&nbsp;Email</p>
        </a>
  


    </menu>
  
</header>

    <div id="wrapper">
      <section id="site-intro" >
  <a href="/"><img src="/images/antomor.jpg" class="hexagon" width="150" alt="Antomor logo" /></a>
  <header>
    <h1>Antomor's personal website.</h1>
  </header>
  <main>
    <p>Where ideas become words (maybe)</p>
  </main>
  
    <footer>
      <ul class="socnet-icons">
        

        <li><a href="//github.com/antomor" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>











<li><a href="//linkedin.com/in/antoniomorrone" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>















<li><a href="//twitter.com/AntonioMorrone7" target="_blank" rel="noopener" title="Twitter" class="fab fa-twitter"></a></li>










<li><a href="mailto:dev@antomor.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
    </footer>
  
</section>

      <main id="site-main">
        <article class="post">
  <header>
  <div class="title">
    
      <h2><a href="/blog/git-move-file-with-history/">Git: Move Files Retaining History</a></h2>
    
    
      <p>How to move files among git repository retaining the history</p>
    
  </div>
  <div class="meta">
    <time class="published" datetime="2020-03-14 12:28:03 &#43;0100 CET">
      March 14, 2020
    </time>
    <span class="author">antomor</span>
    
      <p>3 minutes read</p>
    
  </div>
</header>

  <section id="socnet-share">
    




  
    
    <a href="//twitter.com/share?text=Git%3a%20Move%20Files%20Retaining%20History&amp;url=https%3a%2f%2fantomor.com%2fblog%2fgit-move-file-with-history%2f" target="_blank" rel="noopener" class="share-btn twitter">
        <i class="fab fa-twitter"></i><p>&nbsp;Twitter</p>
      </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fantomor.com%2fblog%2fgit-move-file-with-history%2f&amp;title=Git%3a%20Move%20Files%20Retaining%20History" target="_blank" rel="noopener" class="share-btn linkedin">
            <i class="fab fa-linkedin"></i><p>&nbsp;LinkedIn</p>
          </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by antomor&amp;body=https%3a%2f%2fantomor.com%2fblog%2fgit-move-file-with-history%2f" target="_blank" class="share-btn email" data-proofer-ignore>
          <i class="fas fa-envelope"></i><p>&nbsp;Email</p>
        </a>
  


  </section>
  
  <a href="/blog/git-move-file-with-history/" class="image featured">
    
      <img src="/images/git-move.jpg" alt="">
    
  </a>


  <div class="content">
    <p>Sometimes ago we need to create a new product, that shares many functionalities with the existing one. The first idea was to extract some of the code in a library, to be then imported and used independently in the two projects.</p>
<p>After creating the repository for the library, the first action I would have done was copying the files from one repo to another. Well, it works like a charm, it’s fast and it doesn’t require any particular expertise, a normal drag and drop operation. What’s best? It could be a very effective approach, but &hellip;</p>
<p>During a PR review, I learnt there was a cleaver way to perform such operation and I wasn’t even aware of such possibility before:</p>
<blockquote>
<p>Moving files from one git repository to another retaining the history.</p>
</blockquote>
<h2 id="moving-a-single-directory">Moving a single directory</h2>
<p>From the source repository:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git clone &lt;src_repository&gt; &lt;src_repository&gt;_clone
<span style="color:#75715e"># clone the src repository in new folder</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cd &lt;src_repository&gt;_clone
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git remote rm origin
<span style="color:#75715e"># remove the origin to avoid disasters in case of error</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git filter-branch --subdirectory-filter &lt;directory&gt; -- --all
<span style="color:#75715e"># the magic, rewrite the git history</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir &lt;directory&gt;
mv * &lt;directory&gt;
<span style="color:#75715e"># create the directory and move everything inside</span>
</code></pre></div><p>In the destination repository:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git remote add &lt;src_repository&gt; &lt;git repository A directory&gt;
<span style="color:#75715e"># clone clone the repository, if not previously done</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git pull repo-A master --allow-unrelated-histories
<span style="color:#75715e"># Import the src repository code into the dst repository</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git mv &lt;directory_1&gt; &lt;desired_position&gt;
<span style="color:#75715e"># Optionally, move the just imported files, into the desired position in the new repository</span>
</code></pre></div><h2 id="moving-code-file-by-file">Moving code file-by-file</h2>
<p>The operations required to move many files at once are conceptually the same.
The extraction of the files to be moved will be performed by means of the following script (from Tom Hacohen blog article):</p>
<script type="application/javascript" src="https://gist.github.com/antomor/ac3c0626bb3aa8ab8689449ad6fc4be3.js?file=git-move.sh"></script>

<p>After changing the script to include the files to be imported, it must be executed just before the <code>git filter-branch ...</code> command; this will create a single folder into the repository. So, to recap:</p>
<p>Download the script, and change it according with the files to be copied.</p>
<p>From the source repository:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git clone &lt;src_repository&gt; &lt;src_repository&gt;_clone
<span style="color:#75715e"># clone the src repository in new folder</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cd &lt;src_repository&gt;_clone
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git remote rm origin
<span style="color:#75715e"># remove the origin to avoid disasters in case of error</span>
</code></pre></div><blockquote>
<p><strong>Execute the script previously modified here, so assuming the script has been saved in the parent folder:</strong></p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">bash <span style="color:#66d9ef">$(</span>pwd<span style="color:#66d9ef">)</span>/../git-move.sh
</code></pre></div><p>At this point, the repository contains only the folder and the files specified in the script.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git filter-branch --subdirectory-filter &lt;directory&gt; -- --all
<span style="color:#75715e"># the magic, rewrite the git history</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir &lt;directory&gt;
mv * &lt;directory&gt;
<span style="color:#75715e"># create the directory and move everything inside</span>
</code></pre></div><p>In the destination repository:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git remote add &lt;src_repository&gt; &lt;git repository A directory&gt;
<span style="color:#75715e"># clone clone the repository, if not previously done</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git pull repo-A master --allow-unrelated-histories
<span style="color:#75715e"># Import the src repository code into the dst repository</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git mv &lt;directory_1&gt; &lt;desired_position&gt;
<span style="color:#75715e"># Optionally, move the just imported files, into the desired position in the new repository</span>
</code></pre></div><h2 id="conclusions">Conclusions</h2>
<p>That easy? Yep. Despite the many commands to be run, the advantage of maintaining the history is priceless, especially when we need to investigate some issue, file history could be very useful.</p>
<blockquote>
<p><strong>Tip:</strong> The process could seem counterintuitive, so I suggest to give it a try with some test repository. After the first time, everything will be much clearer.</p>
</blockquote>
<h3 id="resources">Resources</h3>
<ul>
<li><a href="https://medium.com/@ayushya/move-directory-from-one-repository-to-another-preserving-git-history-d210fa049d4b">A useful guide from @ayushya on Medium</a></li>
<li><a href="https://stosb.com/blog/retaining-history-when-moving-files-across-repositories-in-git/">Tom Hacohen explains how to git move single files</a></li>
</ul>

  </div>
  <footer>
    <ul class="stats">
  
    
    
      <li class="categories">
        <ul>
          
            
            <li><a class="article-category-link" href="https://antomor.com/categories/development">Development</a></li>
          
        </ul>
      </li>
    
  
  
    
    
      <li class="tags">
        <ul>
          
            
            <li><a class="article-category-link" href="https://antomor.com/tags/dev">dev</a></li>
          
            
            <li><a class="article-category-link" href="https://antomor.com/tags/git">git</a></li>
          
            
            <li><a class="article-category-link" href="https://antomor.com/tags/blog">blog</a></li>
          
            
            <li><a class="article-category-link" href="https://antomor.com/tags/tutorial">tutorial</a></li>
          
        </ul>
      </li>
    
  
</ul>

  </footer>
</article>


<div class="pagination">
  
    <a href="/blog/mongodb-query-profiler/" class="button"><div class="previous"><div>Mongodb Query Profiler</div></div></a>
  
  
</div>


      </main>
      <section id="site-sidebar">
  
    <section id="recent-posts">
      <header>
        <h1>Recent posts</h1>
      </header>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/git-move-file-with-history/" class="image featured">
    
      <img src="/images/git-move.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h1><a href="/blog/git-move-file-with-history/">Git: Move Files Retaining History</a></h1>
          <time class="published" datetime="">March 14, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/mongodb-query-profiler/" class="image featured">
    
      <img src="/images/mongodb-profiling.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h1><a href="/blog/mongodb-query-profiler/">Mongodb Query Profiler</a></h1>
          <time class="published" datetime="">December 28, 2019</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/security-headers-on-static-websites/" class="image featured">
    
      <img src="/images/sec-headers/key.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h1><a href="/blog/security-headers-on-static-websites/">Security Headers on Static Websites</a></h1>
          <time class="published" datetime="">December 26, 2019</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/gitlab-cd/" class="image featured">
    
      <img src="/images/gitlab-unsplash.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h1><a href="/blog/gitlab-cd/">SPA deployment with GitLab</a></h1>
          <time class="published" datetime="">December 13, 2019</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/browser-extension/" class="image featured">
    
      <img src="/images/web-ext.jpg" alt="">
    
  </a>


        </section>
        <header>
          <h1><a href="/blog/browser-extension/">Browser Extension Development</a></h1>
          <time class="published" datetime="">November 20, 2019</time>
        </header>
      </article>
      
      
        <footer>
          <a href="/blog/" class="button">See more</a>
        </footer>
      
    </section>
  

  
    
      <section id="categories">
        <header>
          <h1><a href="/categories">Categories</a></h1>
        </header>
        <ul>
          
            
          
          
          <li>
            
              <a href="/categories/development/">development<span class="count">5</span></a>
            
          
          <li>
            
              <a href="/categories/other/">other<span class="count">1</span></a>
            
          
          <li>
            
              <a href="/categories/security/">security<span class="count">1</span></a>
            
          
          </li>
        </ul>
      </section>
    
  

  
    <section id="mini-bio">
      <header>
        <h1>About</h1>
      </header>
      <p>Software Engineer passionate about Security and Privacy. Nature and animals lover. Sports (running, yoga, boxing) practitioner.</p>
      <footer>
        <a href="/about" class="button">Learn More</a>
      </footer>
    </section>
  
</section>

      <footer id="site-footer">
  
      <ul class="socnet-icons">
        

        <li><a href="//github.com/antomor" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>











<li><a href="//linkedin.com/in/antoniomorrone" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>















<li><a href="//twitter.com/AntonioMorrone7" target="_blank" rel="noopener" title="Twitter" class="fab fa-twitter"></a></li>










<li><a href="mailto:dev@antomor.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
  
  <p class="copyright">
    
      &copy; 2020
      
        Antomor
      
    . <br>
    Theme: <a href='https://github.com/pacollins/hugo-future-imperfect-slim' target='_blank' rel='noopener'>Hugo Future Imperfect Slim</a><br>A <a href='https://html5up.net/future-imperfect' target='_blank' rel='noopener'>HTML5 UP port</a> | Powered by <a href='https://gohugo.io/' title='0.66.0' target='_blank' rel='noopener'>Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script><script src="/js/bundle.min.e0c399b948d3cf5c3a5e3badb94023d0b064a19ac39fd8cd79fb9f57fa4d1091.js" integrity="sha256-4MOZuUjTz1w6XjutuUAj0LBkoZrDn9jNefufV/pNEJE="></script>
    <script src="/js/add-on.js"></script>
    </div>
  </body>
</html>
